<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tuition Centre Tracker - Firebase</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // üî• REPLACE WITH YOUR FIREBASE CONFIG
       const firebaseConfig = {
  apiKey: "AIzaSyCIi6V8Q7zlKLd7BmjyylD87fLBaKkO65U",
  authDomain: "tuitiontracker-ac584.firebaseapp.com",
  projectId: "tuitiontracker-ac584",
  storageBucket: "tuitiontracker-ac584.firebasestorage.app",
  messagingSenderId: "121462363628",
  appId: "1:121462363628:web:7c9a1e8574dc2d74381cc9"
};

        let database;
        try {
            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
            database = firebase.database();
        } catch (error) {
            console.error("Firebase error:", error);
        }

        const PASSWORDS = { jancy: 'J404', arya: 'Y234', jabeena: 'J123' };

        // Icons
        const Icon = ({ d, ...p }) => <svg {...p} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d={d} /></svg>;

        const App = () => {
            const [user, setUser] = useState(null);
            const [faculty, setFaculty] = useState(null);
            const [pwd, setPwd] = useState('');
            const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
            const [data, setData] = useState({});
            const [students, setStudents] = useState({ jancy: [], arya: [], jabeena: [] });
            const [schedules, setSchedules] = useState({});
            const [exams, setExams] = useState({});
            const [loading, setLoading] = useState(true);
            const [editSchedule, setEditSchedule] = useState(null);
            const [editExam, setEditExam] = useState(null);
            const [examMode, setExamMode] = useState(false);
            const [both, setBoth] = useState(false);

            useEffect(() => {
                if (!database) return;
                database.ref('students').on('value', s => { if(s.exists()) setStudents(s.val()); setLoading(false); });
                database.ref('weeklyData').on('value', s => { if(s.exists()) setData(s.val()); });
                database.ref('schedules').on('value', s => { if(s.exists()) setSchedules(s.val()); });
                database.ref('examSchedules').on('value', s => { if(s.exists()) setExams(s.val()); });
            }, []);

            const login = () => {
                if (pwd === PASSWORDS[faculty]) { setUser(faculty); setPwd(''); }
                else { alert('Wrong password!'); setPwd(''); }
            };

            const grade = (g) => (g === 'LKG' || g === 'UKG') ? 0 : parseInt(g) || 0;
            const studs = () => !user ? [] : [...(students[user] || [])].sort((a,b) => grade(a.grade) - grade(b.grade));
            const toggle = (sid, sub) => {
                const k = `${date}-${sid}-${sub}`;
                if(database) database.ref(`weeklyData/${k}`).set(!data[k]);
            };
            const checked = (sid, sub) => data[`${date}-${sid}-${sub}`] || false;

            const saveSchedule = () => {
                if(!editSchedule?.schedule) return alert('Set schedule');
                if(database) database.ref(`schedules/${editSchedule.id}`).set(editSchedule.schedule);
                setEditSchedule(null);
                alert('Saved!');
            };

            const saveExam = () => {
                if(!editExam?.schedule) return alert('Set exam schedule');
                if(database) database.ref(`examSchedules/${editExam.id}`).set(editExam.schedule);
                setEditExam(null);
                alert('Saved!');
            };

            const colors = { jancy: 'blue', arya: 'green', jabeena: 'gray' };
            const days = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];

            if(loading) return <div className="min-h-screen flex items-center justify-center"><div className="animate-spin h-16 w-16 border-4 border-purple-600 border-t-transparent rounded-full"></div></div>;

            if(!faculty) return (
                <div className="min-h-screen bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                        <h1 className="text-3xl font-bold text-center mb-8">Tuition Tracker</h1>
                        <div className="space-y-4">
                            <button onClick={() => setFaculty('jancy')} className="w-full bg-blue-500 text-white font-bold py-4 rounded-lg hover:bg-blue-600">Jancy</button>
                            <button onClick={() => setFaculty('arya')} className="w-full bg-green-500 text-white font-bold py-4 rounded-lg hover:bg-green-600">Arya</button>
                            <button onClick={() => setFaculty('jabeena')} className="w-full bg-gray-600 text-white font-bold py-4 rounded-lg hover:bg-gray-700">Jabeena</button>
                        </div>
                    </div>
                </div>
            );

            if(!user) return (
                <div className="min-h-screen bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                        <h2 className="text-2xl font-bold text-center mb-4 capitalize">{faculty}</h2>
                        <input type="password" value={pwd} onChange={e=>setPwd(e.target.value)} onKeyPress={e=>e.key==='Enter'&&login()} placeholder="Password" className="w-full px-4 py-3 border-2 rounded-lg mb-4 text-center" autoFocus />
                        <button onClick={login} className="w-full bg-purple-600 text-white font-bold py-3 rounded-lg hover:bg-purple-700 mb-2">Login</button>
                        <button onClick={()=>setFaculty(null)} className="w-full bg-gray-300 text-gray-700 font-bold py-3 rounded-lg hover:bg-gray-400">Back</button>
                    </div>
                </div>
            );

            const list = studs();
            const subs = [...new Set(list.flatMap(s=>s.subjects))].sort();
            const c = colors[user];

            if(editSchedule) {
                const st = list.find(s=>s.id===editSchedule.id);
                return (
                    <div className="min-h-screen bg-gray-50 p-4">
                        <div className="max-w-6xl mx-auto bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-2xl font-bold mb-4">Edit Schedule: {st?.name}</h2>
                            <div className="grid md:grid-cols-3 gap-4">
                                {days.map((day,i) => (
                                    <div key={day} className="border rounded-lg p-4">
                                        <h3 className="font-bold mb-2">{day}</h3>
                                        {st?.subjects.map(sub => (
                                            <label key={sub} className="flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer">
                                                <input type="checkbox" checked={(editSchedule.schedule?.[i]||[]).includes(sub)} 
                                                    onChange={e=>{
                                                        const s = editSchedule.schedule || {};
                                                        const d = s[i] || [];
                                                        s[i] = e.target.checked ? [...d,sub] : d.filter(x=>x!==sub);
                                                        setEditSchedule({...editSchedule, schedule:s});
                                                    }} className="w-4 h-4" />
                                                <span className="text-sm">{sub}</span>
                                            </label>
                                        ))}
                                    </div>
                                ))}
                            </div>
                            <div className="flex gap-3 mt-6">
                                <button onClick={saveSchedule} className="flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700">Save</button>
                                <button onClick={()=>setEditSchedule(null)} className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400">Cancel</button>
                            </div>
                        </div>
                    </div>
                );
            }

            if(editExam) {
                const st = list.find(s=>s.id===editExam.id);
                return (
                    <div className="min-h-screen bg-gray-50 p-4">
                        <div className="max-w-6xl mx-auto bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-2xl font-bold mb-4 text-red-700">Exam Schedule: {st?.name}</h2>
                            <p className="text-sm text-gray-600 mb-4">Select ONE subject per day</p>
                            <div className="grid md:grid-cols-3 gap-4">
                                {days.map((day,i) => (
                                    <div key={day} className="border-2 border-red-200 rounded-lg p-4 bg-red-50">
                                        <h3 className="font-bold mb-2 text-red-900">{day}</h3>
                                        {st?.subjects.map(sub => (
                                            <label key={sub} className="flex items-center gap-2 p-2 hover:bg-red-100 rounded cursor-pointer">
                                                <input type="radio" name={`exam-${i}`} checked={(editExam.schedule?.[i])===sub}
                                                    onChange={()=>{
                                                        const s = editExam.schedule || {};
                                                        s[i] = sub;
                                                        setEditExam({...editExam, schedule:s});
                                                    }} className="w-4 h-4" />
                                                <span className="text-sm font-bold">{sub}</span>
                                            </label>
                                        ))}
                                    </div>
                                ))}
                            </div>
                            <div className="flex gap-3 mt-6">
                                <button onClick={saveExam} className="flex-1 bg-red-600 text-white py-3 rounded-lg font-bold hover:bg-red-700">Save</button>
                                <button onClick={()=>setEditExam(null)} className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400">Cancel</button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    <div className={`bg-${c}-600 text-white p-4`}>
                        <div className="max-w-7xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 className="text-xl font-bold capitalize">{user} Dashboard</h1>
                                <p className="text-sm opacity-90">{list.length} Students</p>
                            </div>
                            <button onClick={()=>{setUser(null);setFaculty(null);}} className="bg-white bg-opacity-20 px-4 py-2 rounded hover:bg-opacity-30">Logout</button>
                        </div>
                    </div>

                    <div className="bg-white border-b p-4">
                        <div className="max-w-7xl mx-auto flex gap-3 items-center flex-wrap">
                            <input type="date" value={date} onChange={e=>setDate(e.target.value)} className="border rounded px-4 py-2" />
                            <label className="flex items-center gap-2 bg-red-50 px-4 py-2 rounded border-2 border-red-300 cursor-pointer ml-auto">
                                <input type="checkbox" checked={examMode} onChange={e=>{setExamMode(e.target.checked);if(!e.target.checked)setBoth(false);}} className="w-4 h-4" />
                                <span className="font-bold text-red-900">Exam Mode</span>
                            </label>
                            {examMode && (
                                <label className="flex items-center gap-2 bg-purple-50 px-4 py-2 rounded border-2 border-purple-300 cursor-pointer">
                                    <input type="checkbox" checked={both} onChange={e=>setBoth(e.target.checked)} className="w-4 h-4" />
                                    <span className="font-bold text-purple-900">Show Both</span>
                                </label>
                            )}
                        </div>
                    </div>

                    <div className="max-w-full mx-auto p-4">
                        <div className="bg-white rounded-lg shadow mb-6 overflow-x-auto">
                            <table className="w-full text-sm">
                                <thead>
                                    <tr className={`bg-${c}-100`}>
                                        <th className="p-3 border">Student</th>
                                        <th className="p-3 border">Grade</th>
                                        <th className="p-3 border">Actions</th>
                                        {subs.map(s => <th key={s} className="p-3 border">{s}</th>)}
                                    </tr>
                                </thead>
                                <tbody>
                                    {list.map(st => (
                                        <tr key={st.id} className="hover:bg-gray-50">
                                            <td className="p-3 border font-bold">{st.name}</td>
                                            <td className="p-3 border text-center">{st.grade}</td>
                                            <td className="p-3 border text-center">
                                                <button onClick={()=>setEditSchedule({id:st.id,schedule:schedules[st.id]||{}})} className="text-blue-600 hover:text-blue-800 mx-1">‚úèÔ∏è</button>
                                                <button onClick={()=>setEditExam({id:st.id,schedule:exams[st.id]||{}})} className="text-red-600 hover:text-red-800 mx-1">üìö</button>
                                            </td>
                                            {subs.map(sub => {
                                                const has = st.subjects.includes(sub);
                                                const chk = checked(st.id, sub);
                                                return has ? (
                                                    <td key={sub} className={`p-3 border cursor-pointer text-center ${chk?'bg-green-100':'hover:bg-blue-50'}`} onClick={()=>toggle(st.id,sub)}>
                                                        {chk ? '‚úÖ' : '‚¨ú'}
                                                    </td>
                                                ) : <td key={sub} className="p-3 border bg-gray-50 text-center">‚Äî</td>;
                                            })}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>

                        {(!examMode || both) && (
                            <div className="bg-blue-50 border-2 border-blue-300 rounded-lg p-6 mb-4">
                                <h3 className="text-xl font-bold text-blue-900 mb-4">üìÖ Weekly Schedule</h3>
                                {list.filter(s=>schedules[s.id]).map(st => (
                                    <div key={st.id} className="bg-white rounded-lg shadow p-4 mb-4">
                                        <h4 className="font-bold mb-3">{st.name}</h4>
                                        <div className="grid grid-cols-6 gap-2">
                                            {days.map((d,i) => (
                                                <div key={d} className="border rounded p-2 bg-blue-50">
                                                    <h5 className="font-bold text-xs text-center mb-2">{d}</h5>
                                                    {(schedules[st.id]?.[i]||[]).map(sub => (
                                                        <div key={sub} className="bg-yellow-100 border border-yellow-300 rounded px-2 py-1 text-xs font-bold text-center mb-1">{sub}</div>
                                                    ))}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {examMode && (
                            <div className="bg-red-50 border-2 border-red-300 rounded-lg p-6">
                                <h3 className="text-xl font-bold text-red-900 mb-4">üìù Exam Schedule</h3>
                                {list.filter(s=>exams[s.id]).map(st => (
                                    <div key={st.id} className="bg-white rounded-lg shadow p-4 mb-4">
                                        <h4 className="font-bold mb-3">{st.name}</h4>
                                        <div className="grid grid-cols-6 gap-2">
                                            {days.map((d,i) => (
                                                <div key={d} className="border-2 border-red-300 rounded p-2 bg-red-50">
                                                    <h5 className="font-bold text-xs text-center mb-2 text-red-900">{d}</h5>
                                                    {exams[st.id]?.[i] ? (
                                                        <div className="bg-red-200 border-2 border-red-400 rounded px-2 py-2 text-xs font-bold text-center">{exams[st.id][i]}</div>
                                                    ) : <div className="text-xs text-gray-400 text-center">Not set</div>}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        <div className="mt-6 bg-blue-50 rounded-lg p-4">
                            <h3 className="font-bold mb-2">üìñ Instructions:</h3>
                            <ul className="text-sm space-y-1">
                                <li>‚úÖ Click checkbox to mark attendance</li>
                                <li>‚úèÔ∏è Click pencil to edit weekly schedule</li>
                                <li>üìö Click book to edit exam schedule (1 subject/day)</li>
                                <li>üéØ Enable "Exam Mode" to show exam timetable</li>
                                <li>üë• Check "Show Both" to display both schedules</li>
                                {user === 'jancy' && <li>üîë Passwords - Jancy: J404, Arya: Y234, Jabeena: J123</li>}
                            </ul>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>