<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tuition Centre Tracker - Firebase</title>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    // Firebase config will be defined once below inside the main script
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const DAYS = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];

    function App() {
      const [user, setUser] = React.useState(null);
      const [tab, setTab] = React.useState("dashboard");
      const [students, setStudents] = React.useState([]);
      const [subjectData, setSubjectData] = React.useState([]);
      const [scheduleList, setScheduleList] = React.useState([]);
      const [examList, setExamList] = React.useState([]);
      const [editSchedule, setEditSchedule] = React.useState(null);
      const [editExam, setEditExam] = React.useState(null);

      React.useEffect(() => {
        auth.onAuthStateChanged(u => {
          setUser(u);
          if (u) {
            loadStudents();
            loadSubjects();
            loadSchedule();
            loadExams();
          }
        });
      }, []);

      const loadStudents = async () => {
        const s = await db.collection("students").orderBy("name").get();
        setStudents(s.docs.map(d => ({ id: d.id, ...d.data() })));
      };

      const loadSubjects = async () => {
        const s = await db.collection("subjects").get();
        setSubjectData(s.docs.map(d => ({ id: d.id, ...d.data() })));
      };

      const loadSchedule = async () => {
        const s = await db.collection("schedule").get();
        setScheduleList(s.docs.map(d => ({ id: d.id, ...d.data() })));
      };

      const loadExams = async () => {
        const e = await db.collection("exams").get();
        setExamList(e.docs.map(d => ({ id: d.id, ...d.data() })));
      };

      const logout = () => auth.signOut();

      if (!user) return (<Login />);

      // ============ EDIT SCHEDULE PAGE ============
      if (editSchedule) {
        const st = scheduleList.find(s => s.id === editSchedule.id);
        if (!st) return null;
        const [subj, setSubj] = React.useState(st.subject);
        const [teacher, setTeacher] = React.useState(st.teacher);
        const [time, setTime] = React.useState(st.time);
        const save = async () => {
          await db.collection("schedule").doc(st.id).update({ subject: subj, teacher, time });
          loadSchedule();
          setEditSchedule(null);
        };

        return (
          <div className="p-6">
            <div className="max-w-xl mx-auto bg-white p-6 rounded shadow">
              <h2 className="text-xl font-bold mb-4">Edit Schedule</h2>
              <input className="border p-2 w-full mb-2" value={subj} onChange={e => setSubj(e.target.value)} />
              <input className="border p-2 w-full mb-2" value={teacher} onChange={e => setTeacher(e.target.value)} />
              <input className="border p-2 w-full mb-2" value={time} onChange={e => setTime(e.target.value)} />
              <div className="flex gap-2 mt-3">
                <button className="bg-blue-500 text-white px-4 py-2 rounded" onClick={save}>Save</button>
                <button className="bg-gray-400 text-white px-4 py-2 rounded" onClick={() => setEditSchedule(null)}>Cancel</button>
              </div>
            </div>
          </div>
        );
      }

      // ============ EDIT EXAM PAGE ============
      if (editExam) {
        const ex = examList.find(s => s.id === editExam.id);
        const [subj, setSubj] = React.useState(ex.subject);
        const [date, setDate] = React.useState(ex.date);
        const save = async () => {
          await db.collection("exams").doc(ex.id).update({ subject: subj, date });
          loadExams();
          setEditExam(null);
        };
        return (
          <div className="p-6">
            <div className="max-w-xl mx-auto bg-white p-6 rounded shadow">
              <h2 className="text-xl font-bold mb-4">Edit Exam</h2>
              <input className="border p-2 w-full mb-2" value={subj} onChange={e => setSubj(e.target.value)} />
              <input className="border p-2 w-full mb-2" value={date} onChange={e => setDate(e.target.value)} />
              <div className="flex gap-2 mt-3">
                <button className="bg-blue-500 text-white px-4 py-2 rounded" onClick={save}>Save</button>
                <button className="bg-gray-400 text-white px-4 py-2 rounded" onClick={() => setEditExam(null)}>Cancel</button>
              </div>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen flex">
          <div className="w-56 bg-white shadow p-4">
            <h1 className="font-bold text-lg mb-4">Tuition Tracker</h1>
            <div className="space-y-2">
              <button onClick={() => setTab("dashboard")} className="w-full bg-gray-200 p-2 rounded">Dashboard</button>
              <button onClick={() => setTab("schedule")} className="w-full bg-gray-200 p-2 rounded">Schedule</button>
              <button onClick={() => setTab("exams")} className="w-full bg-gray-200 p-2 rounded">Exams</button>
              <button onClick={logout} className="w-full bg-red-400 p-2 rounded text-white">Logout</button>
            </div>
          </div>

          <div className="flex-1 p-6 overflow-y-auto">
            {tab === "dashboard" && <Dashboard students={students} subjects={subjectData} db={db} />}
            {tab === "schedule" && <SchedulePage list={scheduleList} setEdit={setEditSchedule} />}
            {tab === "exams" && <ExamPage list={examList} setEdit={setEditExam} />}
          </div>
        </div>
      );
    }

    function Dashboard({ students, subjects, db }) {
      const toggle = async (studentId, subjectId, day) => {
        const ref = db.collection("attendance").doc(`${studentId}_${subjectId}`);
        const snap = await ref.get();
        let data = snap.exists ? snap.data() : { days: {} };
        data.days[day] = !data.days[day];
        ref.set(data);
      };

      return (
        <div>
          <h2 className="text-xl font-bold mb-4">Daily Marking</h2>
          <div className="space-y-4">
            {students.map(st => (
              <div key={st.id} className="bg-white p-4 rounded shadow">
                <h3 className="font-bold text-lg mb-2">{st.name}</h3>
                <table className="w-full text-left">
                  <thead><tr><th>Subject</th>{DAYS.map(d => <th key={d}>{d}</th>)}</tr></thead>
                  <tbody>
                    {subjects.map(sub => (
                      <tr key={sub.id} className="border-t">
                        <td className="py-2">{sub.name}</td>
                        {DAYS.map(d => (
                          <td key={d}>
                            <button onClick={() => toggle(st.id, sub.id, d)} className="px-2 py-1 bg-gray-200 rounded">✔</button>
                          </td>
                        ))}
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function SchedulePage({ list, setEdit }) {
      return (
        <div>
          <h2 className="text-xl font-bold mb-4">Schedule</h2>
          <div className="space-y-3">
            {list.map(s => (
              <div key={s.id} className="bg-white p-4 rounded shadow flex justify-between">
                <div>
                  <div className="font-bold">{s.subject}</div>
                  <div>{s.teacher}</div>
                  <div>{s.time}</div>
                </div>
                <button className="bg-blue-500 text-white px-3 py-1 rounded" onClick={() => setEdit(s)}>Edit</button>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function ExamPage({ list, setEdit }) {
      return (
        <div>
          <h2 className="text-xl font-bold mb-4">Exams</h2>
          <div className="space-y-3">
            {list.map(ex => (
              <div key={ex.id} className="bg-white p-4 rounded shadow flex justify-between">
                <div>
                  <div className="font-bold">{ex.subject}</div>
                  <div>{ex.date}</div>
                </div>
                <button className="bg-blue-500 text-white px-3 py-1 rounded" onClick={() => setEdit(ex)}>Edit</button>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function Login() {
      const [email, setEmail] = React.useState("");
      const [password, setPassword] = React.useState("");

      const login = () => auth.signInWithEmailAndPassword(email, password).catch(alert);

      return (
        <div className="h-screen flex items-center justify-center">
          <div className="bg-white p-6 rounded shadow w-80">
            <h2 className="text-xl font-bold mb-4">Login</h2>
            <input className="border p-2 w-full mb-2" placeholder="Email" value={email} onChange={e => setEmail(e.target.value)} />
            <input className="border p-2 w-full mb-2" type="password" placeholder="Password" value={password} onChange={e => setPassword(e.target.value)} />
            <button className="bg-blue-500 text-white w-full p-2 rounded" onClick={login}>Login</button>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tuition Centre Tracker - Firebase</title>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <!-- Icons -->
    <script src="https://unpkg.com/lucide-react/dist/umd/lucide-react.min.js"></script>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #f3f4f6;
        }
        .btn { padding: 8px 12px; border-radius: 6px; cursor: pointer; }
        .card { background:white; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <div id="root"></div>

<script type="text/babel">
/**************************************************
   FIREBASE INITIALIZATION
**************************************************/
const firebaseConfig = {
            apiKey: "AIzaSyCIi6V8Q7zlKLd7BmjyylD87fLBaKkO65U",
            authDomain: "tuitiontracker-ac584.firebaseapp.com",
            projectId: "tuitiontracker-ac584",
            storageBucket: "tuitiontracker-ac584.firebasestorage.app",
            messagingSenderId: "121462363628",
            appId: "1:121462363628:web:7c9a1e8574dc2d74381cc9",
            databaseURL: "https://tuitiontracker-ac584-default-rtdb.asia-southeast1.firebasedatabase.app/"
        };

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

/**************************************************
  REACT APP
**************************************************/
const { useState, useEffect } = React;

function App() {
    const [user, setUser] = useState(null);

    useEffect(() => {
        const unsubscribe = auth.onAuthStateChanged(u => setUser(u));
        return unsubscribe;
    }, []);

    if (!user) return <LoginPage />;
    return <Dashboard user={user} />;
}

/**************************************************
 LOGIN PAGE
**************************************************/
function LoginPage() {
    const [email, setEmail] = useState("");
    const [pass, setPass] = useState("");
    const [error, setError] = useState("");

    const login = async () => {
        try {
            await auth.signInWithEmailAndPassword(email, pass);
        } catch (e) {
            setError(e.message);
        }
    };

    return (
        <div style={{ padding: "40px", maxWidth: "400px", margin: "80px auto" }}>
            <div className="card">
                <h2>Login</h2>
                <input placeholder="Email" value={email} onChange={e=>setEmail(e.target.value)} /><br /><br />
                <input placeholder="Password" type="password" value={pass} onChange={e=>setPass(e.target.value)} /><br /><br />
                <button className="btn" onClick={login}>Login</button>
                {error && <p style={{color:"red"}}>{error}</p>}
            </div>
        </div>
    );
}

/**************************************************
 DASHBOARD + MENU
**************************************************/
function Dashboard() {
    const [tab, setTab] = useState("students");

    const logout = () => auth.signOut();

    return (
        <div style={{ display: "flex" }}>
            <div style={{ width: "220px", background: "#1f2937", color: "white", height: "100vh", padding: "20px" }}>
                <h2>Menu</h2>
                <p className="btn" onClick={() => setTab("students")}>Students</p>
                <p className="btn" onClick={() => setTab("subjects")}>Subjects</p>
                <p className="btn" onClick={() => setTab("schedule")}>Class Schedule</p>
                <p className="btn" onClick={() => setTab("exams")}>Exam Schedule</p>
                <p className="btn" onClick={() => setTab("reports")}>Reports</p>
                <p className="btn" onClick={logout} style={{ marginTop: "40px", background: "#dc2626" }}>Logout</p>
            </div>

            <div style={{ padding: "20px", width: "100%" }}>
                {tab === "students" && <Students />}
                {tab === "subjects" && <Subjects />}
                {tab === "schedule" && <ClassSchedule />}
                {tab === "exams" && <Exams />}
                {tab === "reports" && <Reports />}
            </div>
        </div>
    );
}

/**************************************************
 STUDENTS PAGE
**************************************************/
function Students() {
    const [list, setList] = useState([]);
    const [name, setName] = useState("");

    useEffect(() => {
        return db.collection("students").onSnapshot(snap => {
            setList(snap.docs.map(d => ({ id: d.id, ...d.data() })));
        });
    }, []);

    const add = async () => {
        if (!name) return;
        await db.collection("students").add({ name });
        setName("");
    };

    return (
        <div>
            <h2>Students</h2>
            <input value={name} placeholder="New Student" onChange={e=>setName(e.target.value)} />
            <button className="btn" onClick={add}>Add</button>

            <ul>
                {list.map(s => <li key={s.id}>{s.name}</li>)}
            </ul>
        </div>
    );
}

/**************************************************
 SUBJECT PAGE
**************************************************/
function Subjects() {
    const [list, setList] = useState([]);
    const [name, setName] = useState("");

    useEffect(() => {
        return db.collection("subjects").onSnapshot(snap => {
            setList(snap.docs.map(d => ({ id: d.id, ...d.data() })));
        });
    }, []);

    const add = async () => {
        if (!name) return;
        await db.collection("subjects").add({ name });
        setName("");
    };

    return (
        <div>
            <h2>Subjects</h2>
            <input value={name} placeholder="New Subject" onChange={e=>setName(e.target.value)} />
            <button className="btn" onClick={add}>Add</button>

            <ul>
                {list.map(s => <li key={s.id}>{s.name}</li>)}
            </ul>
        </div>
    );
}

/**************************************************
 CLASS SCHEDULE PAGE
**************************************************/
function ClassSchedule() {
    const [schedule, setSchedule] = useState([]);
    const [day, setDay] = useState("");
    const [subject, setSubject] = useState("");

    useEffect(() => {
        return db.collection("schedule").onSnapshot(snap => {
            setSchedule(snap.docs.map(d => ({ id: d.id, ...d.data() })));
        });
    }, []);

    const add = async () => {
        if (!day || !subject) return;
        await db.collection("schedule").add({ day, subject });
    };

    return (
        <div>
            <h2>Class Schedule</h2>
            <input placeholder="Day" value={day} onChange={e=>setDay(e.target.value)} />
            <input placeholder="Subject" value={subject} onChange={e=>setSubject(e.target.value)} />
            <button className="btn" onClick={add}>Add</button>

            <ul>
                {schedule.map(s => <li key={s.id}>{s.day} — {s.subject}</li>)}
            </ul>
        </div>
    );
}

/**************************************************
 EXAM SCHEDULE PAGE
**************************************************/
function Exams() {
    const [list, setList] = useState([]);
    const [subject, setSubject] = useState("");
    const [date, setDate] = useState("");

    useEffect(() => {
        return db.collection("exams").onSnapshot(snap => {
            setList(snap.docs.map(d => ({ id: d.id, ...d.data() })));
        });
    }, []);

    const add = async () => {
        if (!subject || !date) return;
        await db.collection("exams").add({ subject, date });
    };

    return (
        <div>
            <h2>Exam Schedule</h2>
            <input placeholder="Subject" value={subject} onChange={e=>setSubject(e.target.value)} />
            <input type="date" value={date} onChange={e=>setDate(e.target.value)} />
            <button className="btn" onClick={add}>Add Exam</button>

            <ul>
                {list.map(e => <li key={e.id}>{e.subject} — {e.date}</li>)}
            </ul>
        </div>
    );
}

/**************************************************
 REPORTS
**************************************************/
function Reports() {
    return <h2>Reports Coming Soon</h2>;
}

/**************************************************
 RENDER APP
**************************************************/
ReactDOM.createRoot(document.getElementById("root")).render(<App />);

</script>

</body>
</html>
